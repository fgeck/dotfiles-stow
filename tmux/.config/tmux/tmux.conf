# ==============================================================================
# Terminal Settings
# ==============================================================================

# Enable true color (24-bit) support for xterm-compatible terminals
set-option -sa terminal-overrides ",xterm*:Tc"

# Set default terminal to 256-color mode for proper color rendering
set -g default-terminal "tmux-256color"

# Enable undercurl support (wavy underlines used in some editors like Neovim)
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'

# Enable mouse support (scroll, select, resize panes)
set -g mouse on

# ==============================================================================
# Window Navigation
# ==============================================================================

# Cycle through windows with Alt+H (previous) and Alt+L (next)
bind -n M-H previous-window
bind -n M-L next-window

# ==============================================================================
# Clipboard / Copy-Paste (macOS)
# ==============================================================================

# Enable OSC 52 clipboard integration for terminal apps
set -g set-clipboard on

# ==============================================================================
# Prefix Key
# ==============================================================================

# Unbind default prefix (Ctrl+b)
unbind C-b

# Set new prefix to Ctrl+Space (easier to reach)
set -g prefix C-Space

# Allow sending Ctrl+Space to applications by pressing it twice
bind C-Space send-prefix

# ==============================================================================
# Window and Pane Indexing
# ==============================================================================

# Start window numbering at 1 instead of 0 (matches keyboard layout)
set -g base-index 1

# Start pane numbering at 1 instead of 0
set -g pane-base-index 1
set-window-option -g pane-base-index 1

# Automatically renumber windows when one is closed
set-option -g renumber-windows on

# ==============================================================================
# Vi Mode and Copy Keybindings
# ==============================================================================

# Use vi-style keybindings in copy mode
set-window-option -g mode-keys vi

# 'v' starts visual selection (like in Vim)
bind-key -T copy-mode-vi v send-keys -X begin-selection

# 'Ctrl+v' toggles rectangle/block selection mode
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle

# 'y' yanks selection to macOS clipboard and exits copy mode
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"

# Mouse drag selection automatically copies to macOS clipboard
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# ==============================================================================
# Pane Management
# ==============================================================================

# Split pane horizontally (top/bottom), open in current directory
bind '"' split-window -v -c "#{pane_current_path}"

# Split pane vertically (left/right), open in current directory
bind % split-window -h -c "#{pane_current_path}"

# Toggle fullscreen (zoom) on current pane with prefix+f
bind f resize-pane -Z

# ==============================================================================
# Plugins (managed by TPM - Tmux Plugin Manager)
# ==============================================================================

# TPM - Tmux Plugin Manager (required for plugin management)
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults for tmux (better settings out of the box)
set -g @plugin 'tmux-plugins/tmux-sensible'

# Seamless navigation between tmux panes and vim splits using Ctrl+hjkl
set -g @plugin 'christoomey/vim-tmux-navigator'

# Catppuccin theme for a nice status bar appearance
set -g @plugin 'catppuccin/tmux#v2.1.3'

# ==============================================================================
# Theme Configuration
# ==============================================================================

# Use the 'mocha' flavor of Catppuccin (dark theme)
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_window_status_style 'slanted'

# Make the status line pretty and add some modules
set -g status-right-length 100
set -g status-left-length 100
set -g status-right "#{E:@catppuccin_status_directory}"
set -ag status-right "#{E:@catppuccin_status_session}"

# ==============================================================================
# Initialize TPM (MUST be at the very bottom)
# ==============================================================================
run '~/.tmux/plugins/tpm/tpm'
